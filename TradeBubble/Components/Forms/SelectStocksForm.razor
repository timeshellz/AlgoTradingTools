@using AlgoTrading.Broker
@using AlgoTrading.Stocks  
@using TradeBubble.Components.Layouts
@using TradeBubble.Components.Containers  

@using Syncfusion.Blazor.Grids;

@using TradeBubble.ViewModels; 

<CellPage>
    <ContentCell ColumnWidth="6" CellTitle="Downloaded Stocks">
        <SfGrid @ref="availableStocks" DataSource="@AvailableStocks" TValue="StockIdentifier" AllowPaging="true" AllowSorting="true">
            <GridPageSettings PageSize="10" />
            <GridColumns>
                <GridColumn Field="@($"{nameof(StockIdentifier.Name)}")"
                            HeaderText="Name" IsPrimaryKey="true" />
                <GridColumn Field="@($"{nameof(StockIdentifier.FIGI)}")"
                            HeaderText="Name" IsPrimaryKey="true" />
                <GridColumn Field="@($"{nameof(StockIdentifier.Interval)}")"
                            HeaderText="Interval" IsPrimaryKey="true" />
            </GridColumns>
            <GridEvents TValue="StockIdentifier" OnRecordDoubleClick="OnAvailableRowDoubleClick"></GridEvents>
            <GridSortSettings>
                <GridSortColumns>
                    <GridSortColumn Field="@($"{nameof(StockIdentifier.Name)}")" 
                                    Direction="SortDirection.Ascending" />
                </GridSortColumns>
            </GridSortSettings>         
        </SfGrid>
    </ContentCell>
    <ContentCell ColumnWidth="6" CellTitle="Selected Stocks">
        <SfGrid @ref="selectedStocks" DataSource="@SelectedStocks" TValue="StockIdentifier" AllowPaging="true" AllowSorting="true">
            <GridPageSettings PageSize="10" />
            <GridColumns>
                <GridColumn Field="@($"{nameof(StockIdentifier.Name)}")"
                            HeaderText="Name" IsPrimaryKey="true" />
                <GridColumn Field="@($"{nameof(StockIdentifier.FIGI)}")"
                            HeaderText="Name" IsPrimaryKey="true" />
                <GridColumn Field="@($"{nameof(StockIdentifier.Interval)}")"
                            HeaderText="Interval" IsPrimaryKey="true" />
            </GridColumns>
            <GridEvents TValue="StockIdentifier" OnRecordDoubleClick="OnSelectedStockRowDoubleClick"></GridEvents>
            <GridSortSettings>
                <GridSortColumns>
                    <GridSortColumn Field="@($"{nameof(StockIdentifier.Name)}")"
                                    Direction="SortDirection.Ascending" />
                </GridSortColumns>
            </GridSortSettings>
        </SfGrid>
    </ContentCell>
</CellPage>

@code {
    private SfGrid<StockIdentifier> availableStocks;
    private SfGrid<StockIdentifier> selectedStocks;

    [Parameter]
    public List<StockIdentifier> AvailableStocks { get; set; }

    [Parameter]
    public List<StockIdentifier> SelectedStocks { get; set; }

    public void OnAvailableRowDoubleClick(RecordDoubleClickEventArgs<StockIdentifier> args)
    {
        if (!SelectedStocks.Contains(args.RowData))
            SelectedStocks.Add(args.RowData);

        selectedStocks.Refresh();
    }

    public void OnSelectedStockRowDoubleClick(RecordDoubleClickEventArgs<StockIdentifier> args)
    {
        SelectedStocks.Remove(args.RowData);

        selectedStocks.Refresh();
    }
}
